# Covi.Configuration

All application constants for the sake of simplicity are aggregated in the **Covi.Configuration project, Constants.cs** file. Constants are managed by the preview version of the [Mobile.BuildTools](https://mobilebuildtools.com/) package. It provides two ways to store constants:

* By storing them as secrets;
* By storing them in the configuration file.

Secret file should be located in the **Covi.Configuration** project; also there are two configuration files, one for each platform.

Differences between the secrets and configuration files:

| Criteria   | secrets.json  |  app.config |
|----------|---------------|-------|
| Availability |  Generates **Secrets.cs** file at compilation time, constants are available as soon as the application starts. | **App.config** file is loaded and parsed at the runtime, thus configuration constants are available after configuration initialization. |
| Scope | It is possible to create multiple secret files for each project, but currently there is only one **secrets.json** file with constants for all application. | There are two **app.config** files: one in **Covi.Android**, and the other in the **Covi.iOS** project. |
| Flexibility | **Buildtools.json** allows to create secret constants of several types; also there is an ability to create an array of values. | **App.config** values can be read only as string values, it is required to transform them when necessary. |
| Relevant files to add new constants | **secrets.json, buildtools.json, Covi.Configuraiton.Constants.cs** | **app.config, Covi.Configuraiton.Constants.cs** |
| Security | **Secrets.json** should be either removed from the commits or should have mock values while it is located in the public repository. | There are no recommendations regarding **app.config** security. |

## To add new configuration constant

1. Open app.config platform specific file (Resources/app.config for iOS; Assets/app.config for Android);
2. Add required string constant with specified name as xml node, sample:

```xml
<add key="Constants_StringValue" value="Constant value" />
```

3. Ensure that `ConfigurationManager.Init(true, this)` is called upon application start;
4. Update `Initialize(IEnvironmentConfiguration environmentConfiguration)` method in the **Covi.Configuraiton.Constants** class. Create corresponding static get-only properties for newly created constants;
5. New constant will be set upon application start in the `Initialize` method.

You may also create specific extension methods for the `IEnvironmentConfiguration` to retreive specific configuration constant for the sake of the feature-based approach: instead of having one `Constants` class with all constants in the applicaiton, specific feature will retreive specific only for that feature configuration value.

## To add new secret constant

1. Open **secrets.json** file in the **Covi.Configuration** project;
2. Add json item with specified name, sample:

```json
"Constants_StringValue": "Constant value"
```

3. Open **buildtools.json** file in the core of the solution folder (inside of the src folder);
4. Add new property with the required name in the "properties" array, sample:

```json
{
    "name": "Constants_StringValue",
    "type": "string",
    "isArray": false
}
```

5. You can create array-constants by specifying "isArray" field, adding "delimiter" property and putting specified delimiter in the string constants in the **secrets.json** file;
6. More information about secrets configuration: https://mobilebuildtools.com/config/secrets/configuration/ ;
7. Add new constants in the **Covi.Configuraiton.Constants** file, referencing autogenerated Secrets.cs file. Intellisense might show some false-positive errors;
8. If **Covi.Configuraiton** project compilation was successful, then new constants are ready to use in code.
